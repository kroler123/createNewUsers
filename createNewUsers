#!groovy
// Check properties
properties([disableConcurrentBuilds()])

pipeline {
        agent {
                label 'master'
        }
        parameters {

		string(name: 'SALON', defaultValue: 'null', description: 'Input number salon')

	}
        options {
                buildDiscarder(logRotator(numToKeepStr: '10', artifactNumToKeepStr: '10'))
                timestamps()
                skipStagesAfterUnstable()
                disableConcurrentBuilds()
        }
	stages {
                stage("Скачиваем базу в файл") {
                        steps {
                                script {
                                        sh (script: 'mysql -h 192.168.102.2 -u kalinkin -p159753 -Bse "SELECT Domain_Controller FROM rbt WHERE virtual = \'proxmox\' AND Domain_Controller" -D RBT > DB',label: 'Download DB in the file \"DB\"')
                                }
                        }
                }
		stage("Чтение файла") {
			steps {
				script {
					sh (script: '''#!/bin/bash
							 while read line; do fping "$line" ; done < DB
							''',label: 'Чтение из файла')
//					sh (script: 'while read line; do ssh -o \'StrictHostKeyChecking no\' root@"$line" ip a < /dev/null ; done < DB',label: 'Чтение из файла')
				}
			}
		}
	}
}
